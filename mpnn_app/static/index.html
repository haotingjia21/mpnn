<!doctype html>
<meta charset="utf-8">
<title>mpnn-mock</title>
<style>
body{font:14px system-ui,sans-serif;margin:16px;max-width:920px}
input,button{font:inherit}
table{border-collapse:collapse;width:100%}
td,th{border:1px solid #ddd;padding:6px;vertical-align:top}
.mono{font-family:ui-monospace,Menlo,Consolas,monospace;white-space:pre-wrap;word-break:break-word}
.diff{background:#ffe8a3}
.err{color:#b00020}
</style>

<h3>mpnn-mock</h3>

<div>
  <input id="file" type="file" accept=".pdb,.cif">
  <input id="chains" placeholder="chains (optional)" size="16">
  <input id="n" type="number" value="5" min="1" max="200" style="width:70px">
  <button id="go">design</button>
</div>

<div id="status" style="margin:10px 0"></div>
<div id="out"></div>

<script>
const $=id=>document.getElementById(id);

function seqWithDiff(orig, seq){
  if(!orig) return `<div class="mono">${seq}</div>`;
  const L=Math.min(orig.length, seq.length);
  let h='<div class="mono">';
  for(let i=0;i<L;i++){
    const ch=seq[i];
    h += (orig[i]===ch) ? ch : `<span class="diff">${ch}</span>`;
  }
  if(seq.length>L) h += `<span class="diff">${seq.slice(L)}</span>`;
  return h+'</div>';
}

$("go").onclick = async () => {
  $("status").textContent = "";
  $("out").innerHTML = "";
  const f=$("file").files[0];
  if(!f){ $("status").innerHTML='<span class="err">upload .pdb/.cif</span>'; return; }
  const fd=new FormData();
  fd.append("structure", f);
  const ch=$("chains").value.trim(); if(ch) fd.append("chains", ch);
  fd.append("num_sequences", $("n").value);

  $("status").textContent="â€¦";
  try{
    const r=await fetch("/design",{method:"POST",body:fd});
    const data=await r.json();
    if(!r.ok) throw new Error(data.detail||"request failed");
    const orig=data.original_sequences||{};
    const designs=data.designed_sequences||[];
    $("status").textContent=`ok (${data.metadata.runtime_ms} ms)`;

    let html='<table><thead><tr><th>chain</th><th>rank</th><th>sequence</th></tr></thead><tbody>';
    for(const d of designs){
      const o=orig[d.chain]||"";
      html += `<tr><td>${d.chain}</td><td>${d.rank}</td><td>${seqWithDiff(o,d.sequence)}</td></tr>`;
    }
    html+='</tbody></table>';
    $("out").innerHTML=html;
  }catch(e){
    $("status").innerHTML=`<span class="err">${e.message}</span>`;
  }
};
</script>
