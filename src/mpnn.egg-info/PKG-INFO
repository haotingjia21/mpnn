Metadata-Version: 2.4
Name: mpnn
Version: 0.1.0
Summary: ProteinMPNN mini-service (REST + minimal UI)
Requires-Python: >=3.10
Description-Content-Type: text/markdown
Requires-Dist: fastapi>=0.110
Requires-Dist: uvicorn[standard]>=0.29
Requires-Dist: python-multipart>=0.0.9
Requires-Dist: pydantic>=2.6
Requires-Dist: dash>=2.14
Requires-Dist: requests>=2.31
Requires-Dist: biopython>=1.83
Requires-Dist: numpy>=1.24
Provides-Extra: mpnn
Requires-Dist: torch>=2.1; extra == "mpnn"
Provides-Extra: dev
Requires-Dist: pytest>=8; extra == "dev"
Requires-Dist: httpx>=0.27; extra == "dev"
Requires-Dist: ruff>=0.6; extra == "dev"

# ProteinMPNN mini-service (REST + UI)

A minimal wrapper around **dauparas/ProteinMPNN** providing:

- `POST /design`: multipart upload (`structure` file + `payload` JSON)
- `GET /health`
- a small Dash UI mounted at `/`

The UI shows the **original** sequence (no highlight) and highlights residues in designed sequences that differ from the original.

## Env setup
conda env create -f environment.yml
conda activate mpnn


## Run locally (dev)

You need a local ProteinMPNN checkout and must point the service to `protein_mpnn_run.py`:

```bash
export PROTEIN_MPNN_SCRIPT=/path/to/ProteinMPNN/protein_mpnn_run.py
uvicorn mpnn_app.api:app --reload --host 0.0.0.0 --port 8000
```

Open:
- UI: http://localhost:8000/
- Health: http://localhost:8000/health

Try requests:

```bash
bash requests/health.curl.sh
PDB_PATH='examples/PDB_monomers/pdbs/5L33.pdb'
bash requests/design.curl.sh "$PDB_PATH" requests/payload.a.json
```

## Run with Docker (recommended)

The Docker image **clones ProteinMPNN during build** and sets `PROTEIN_MPNN_SCRIPT` automatically.

```bash
docker build -t mpnn .
docker run --rm -p 8000:8000 -v "$(pwd)/runs:/data/runs" mpnn
```

### Output location

Inside the container, jobs are written to:

- `/data/runs/jobs/<job_id>/...`

With the volume mount above, outputs appear on the host at:

- `./runs/jobs/<job_id>/...`

## API

### `POST /design`

- Content-Type: `multipart/form-data`
- Form fields:
  - `structure`: `.pdb`, `.cif`, or `.mmcif`
  - `payload`: JSON string, e.g.

```json
{ "chains": "A B", "num_sequences": 5 }
```

Notes:
- If you omit `chains`, ProteinMPNN chooses defaults (its own behavior).
- This wrapper treats the **first FASTA record** in ProteinMPNN output as the **original** sequence, and records `diff_positions` for each designed sequence.
