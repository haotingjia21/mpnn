Metadata-Version: 2.4
Name: mpnn
Version: 0.1.0
Summary: ProteinMPNN mini-service (REST + minimal UI)
Requires-Python: >=3.10
Description-Content-Type: text/markdown
Requires-Dist: fastapi>=0.110
Requires-Dist: uvicorn[standard]>=0.29
Requires-Dist: python-multipart>=0.0.9
Requires-Dist: pydantic>=2.6
Requires-Dist: dash>=2.14
Requires-Dist: requests>=2.31
Requires-Dist: biopython>=1.83
Requires-Dist: numpy>=1.24
Provides-Extra: mpnn
Requires-Dist: torch>=2.1; extra == "mpnn"
Provides-Extra: dev
Requires-Dist: pytest>=8; extra == "dev"
Requires-Dist: httpx>=0.27; extra == "dev"
Requires-Dist: ruff>=0.6; extra == "dev"

# ProteinMPNN mini-service

This repo is a minimal wrapper around dauparas/ProteinMPNN that provides:

- **Service (`mpnn.app.api:app`)**: FastAPI `POST /design` + `GET /health`
- **Core runner (`mpnn.run_design`)**: stateless, file-contract execution
- **UI**: a small Dash UI mounted at `/` that calls the same `/design` endpoint

## Set up

Create env:
```bash
conda env create -f environment.yml
conda activate mpnn
pip install -e ".[dev]"
```

Build (make sure docker installed):
```bash
docker build -t mpnn .
```

## Run
Run and outputs to local:
```bash
docker run --rm -p 8000:8000 \
  -v "$PWD/runs:/data/runs" \
  -e MPNN_JOBS_DIR=/data/runs/jobs \
  mpnn
```

- API: `http://localhost:8000/health`, `http://localhost:8000/design`
- UI: `http://localhost:8000/`

## Sample requests

Run sample requests against a running service:

```bash
python scripts/client.py health
python scripts/client.py design examples/toy.pdb --chains A --nseq 5 --model v_48_020
python scripts/client.py design examples/PDB_monomers/pdbs/5L33.pdb
```

## Tests
```bash
pip install -e ".[mpnn]"
pytest
```

Tests stub the core execution so they don’t require a real ProteinMPNN run.


## REST API
### `POST /design` (multipart: JSON payload + pdb/cif)

- **File field**: `structure` (`.pdb`, `.cif`)
- **Form field**: `payload` (JSON string)

Payload:
```json
{
  "chains": "A",             // e.g. "A"/["A","B"]/empty(each chain results)
  "num_sequences": 5,        // default 5
  "model_name": "v_48_020"   // UI dropdown; passed to ProteinMPNN --model_name
}
```

### Response JSON
Matches HW format (metadata + original + designed sequences). `seed` is fixed to `0`.

## Output artifacts (per request / job)

The service creates a job directory under `MPNN_JOBS_DIR` (default `runs/jobs`):

```
runs/jobs/<id>/
  input/
    <original_uploaded_filename>
    <stem>.pdb                # ensured for helper scripts (converted from CIF if needed)
  output/
    run.log
    parsed_pdbs.jsonl
    chain_id.jsonl            # always present
    response.json             # same JSON returned by /design
    seqs/
      <stem>_res.fa
```


## Environment variables

- `PROTEIN_MPNN_DIR` (default: `/opt/ProteinMPNN`) — where ProteinMPNN is cloned in the container
- `MPNN_TIMEOUT_SEC` (default: `600`)
- `MPNN_JOBS_DIR` (default: `runs/jobs`) — service job base directory

